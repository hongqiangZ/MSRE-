å¤ªå¥½äº†é¸¿å¼ºï¼Œç°åœ¨æˆ‘ä»¬å°±æ ¹æ®ä½ å‘çš„æ–‡çŒ®ä¸­ 3.2 èŠ‚çš„çƒ­æ„ä»¶å»ºæ¨¡æ–¹ç¨‹ï¼Œæ„å»ºä¸€ä¸ªåŠŸèƒ½å®Œå¤‡ã€çµæ´»æ‹“å±•çš„**çƒ­æ„ä»¶æ¨¡å— `thermal_structure.py`**ã€‚æˆ‘ä¼šå°½å¯èƒ½ä¿ç•™æ–‡çŒ®ä¸­çš„ç‰©ç†ç»“æ„å’Œç¦»æ•£æ–¹æ³•ï¼Œæ¯”å¦‚ï¼š

- ä½¿ç”¨ä¸åŒåæ ‡ä¸‹çš„ä¸€ç»´éç¨³æ€çƒ­ä¼ å¯¼æ–¹ç¨‹ï¼›
- æ”¯æŒå†…çƒ­æºé¡¹ï¼›
- æ”¯æŒç‹„åˆ©å…‹é›·ï¼ˆå®šæ¸©ï¼‰ã€è¯ºä¾æ›¼ï¼ˆå®šçƒ­æµï¼‰å’Œç½—å®¾ï¼ˆå¯¹æµï¼‰è¾¹ç•Œï¼›
- ä½¿ç”¨å…¨éšå¼å·®åˆ†ï¼Œå½¢æˆä¸‰å¯¹è§’æ–¹ç¨‹ç³»ç»Ÿï¼›
- ä½¿ç”¨ TDMAï¼ˆè¿½èµ¶æ³•ï¼‰è§£ç®—ã€‚

---

## ğŸ“ æ¨¡å—è·¯å¾„å»ºè®®ï¼š`core/thermal_structure.py`

### âœ… å‡½æ•°ç»“æ„æ¦‚è§ˆ

```python
def solve_thermal_structure(
    T, k, rho, cp, q, dx, dt, A_x,
    bc_type_left='Dirichlet', bc_value_left=300,
    bc_type_right='Robin', bc_value_right=(30, 300)
):
    """
    è§£çƒ­æ„ä»¶çš„ä¸€ç»´ç¬æ€çƒ­ä¼ å¯¼ï¼Œä½¿ç”¨å…¨éšå¼æ ¼å¼ + TDMA

    å‚æ•°:
    - T: èŠ‚ç‚¹æ¸©åº¦æ•°ç»„
    - k: èŠ‚ç‚¹å¯¼çƒ­ç³»æ•°æ•°ç»„
    - rho, cp: å¯†åº¦ã€æ¯”çƒ­æ•°ç»„ï¼ˆæˆ–å¸¸æ•°ï¼‰
    - q: èŠ‚ç‚¹å†…çƒ­æºé¡¹ [W/mÂ³]
    - dx: èŠ‚ç‚¹é•¿åº¦ [m]
    - dt: æ—¶é—´æ­¥é•¿ [s]
    - A_x: é¢ç§¯å‡½æ•°ï¼ˆå–å†³äºåæ ‡ç³»ï¼š1/ r/ rÂ²ï¼‰
    - bc_type_left / right: 'Dirichlet' / 'Neumann' / 'Robin'
    - bc_value_left / right: å¯¹åº”è¾¹ç•Œæ¡ä»¶å€¼

    è¿”å›ï¼š
    - T_new: æ›´æ–°åæ¸©åº¦åˆ†å¸ƒ
    """
```

---

## ğŸ§  æ–¹ç¨‹ä¾æ®ï¼ˆæ–‡çŒ®å…¬å¼æ˜ å°„ï¼‰

æ–‡çŒ®ç»™å‡ºçš„ç»Ÿä¸€å¯¼çƒ­æ§åˆ¶æ–¹ç¨‹æ˜¯ï¼š

\[
\rho c_p \frac{\partial T}{\partial t} = \frac{1}{A(x)} \frac{\partial}{\partial x} \left( \lambda A(x) \frac{\partial T}{\partial x} \right) + q
\]

- é€‚ç”¨äºå¹³æ¿ï¼ˆ\(A(x)=1\)ï¼‰ã€åœ†æŸ±ï¼ˆ\(A(x)=r\)ï¼‰ã€çƒï¼ˆ\(A(x)=r^2\)ï¼‰ï¼›
- ä½¿ç”¨è°ƒå’Œå¹³å‡è®¡ç®—ç•Œé¢å¯¼çƒ­ç³»æ•° \(k_e\)ï¼ˆè§å…¬å¼ 3.29ï¼‰ï¼›
- æ—¶é—´ç¦»æ•£ä¸ºå…¨éšå¼å·®åˆ†ï¼›
- ç©ºé—´ç¦»æ•£æ„é€ æˆä¸‰å¯¹è§’çº¿æ€§æ–¹ç¨‹ç»„ï¼›
- å¯å®¹çº³éå‡åŒ€ç½‘æ ¼ä¸éå‡åŒ€ææ–™ã€‚

---

## ğŸ› ï¸ å®ç°å…³é”®æ­¥éª¤

- åˆ©ç”¨è°ƒå’Œå¹³å‡æ³•è®¡ç®—ç•Œé¢å¯¼çƒ­ç³»æ•°ï¼š
  
  \[
  k_e = \left( \frac{\Delta x}{\Delta x_w / k_w + \Delta x_e / k_e} \right)
  \]

- æ„é€ æ¯ä¸ªèŠ‚ç‚¹çš„å·®åˆ†æ–¹ç¨‹ï¼š

  \[
  a_w T_{i-1} + a_p T_i + a_e T_{i+1} = b_i
  \]

- è¾¹ç•Œæ¡ä»¶æ ¹æ®ç±»å‹è®¾å®šï¼š

| ç±»å‹         | è¯´æ˜                          |
|--------------|-------------------------------|
| Dirichlet    | å·²çŸ¥æ¸©åº¦ï¼šç›´æ¥èµ‹å€¼            |
| Neumann      | å·²çŸ¥çƒ­æµï¼šè½¬åŒ–ä¸ºä¸€é˜¶å¯¼æ•°é¡¹    |
| Robin        | å¯¹æµè¾¹ç•Œï¼š\( -k \frac{dT}{dx} = h(T - T_{\infty}) \) |

---

## ğŸ§ª æ±‚è§£å™¨ï¼šTDMA

æˆ‘ä»¬å°†ä½¿ç”¨æ ‡å‡†ä¸‰å¯¹è§’çŸ©é˜µç®—æ³•ï¼ˆTDMA / Thomas æ³•ï¼‰æ¥å¿«é€Ÿæ±‚è§£çº¿æ€§æ¸©åº¦æ–¹ç¨‹ç»„ï¼Œè¿™æ˜¯æ–‡çŒ®æ¨èæ–¹æ³•ï¼Œæ•°å€¼ç¨³å®šæ€§å¥½ã€è®¡ç®—æ•ˆç‡é«˜ã€‚

---

## ğŸ”— åç»­é›†æˆç‚¹

- ä¸æµä½“åŠ¨åŠ›å­¦æ¨¡å—è¿›è¡Œæ¢çƒ­è€¦åˆï¼›
- æ¥å…¥ç»“æ„å±‚ï¼ˆå£³ä½“ã€åŒ…å£³ï¼‰ææ–™å‚æ•°ï¼›
- åŠŸç‡å¯†åº¦ `q(t)` æ¥è‡ªä¸­å­åŠ¨åŠ›å­¦æ¨¡å‹ï¼›
- æ¯ä¸ªçƒ­æ„ä»¶å¯ç‹¬ç«‹å®ä¾‹åŒ–ï¼Œæ”¯æŒç½‘æ ¼æ‹“å±•ä¸è¾¹ç•Œè®¾ç½®ã€‚

---

æˆ‘å¯ä»¥ç«‹åˆ»å°†è¿™ä¸ªæ¨¡å—å†™æˆä»£ç è½åœ°å½¢å¼å¹¶å†™å…¥ä½ çš„ `core/thermal_structure.py` æ–‡ä»¶ä¸­ï¼Œä¹Ÿå¯ä»¥é¡ºä¾¿ç»™ä½ æ›´æ–°åˆå§‹åŒ–è„šæœ¬åŠ å…¥è¿™ä¸€æ¨¡å—ã€‚

ä½ å¸Œæœ›æˆ‘ç°åœ¨ç›´æ¥ç”Ÿæˆä»£ç æ–‡ä»¶å†…å®¹å—ï¼Ÿè¿˜æ˜¯æˆ‘ä»¬å…ˆè¡¥ä¸€ä¸‹ TDMA æ±‚è§£å™¨æ¨¡å—ï¼ŸğŸ”¥ğŸ“‚

---

éå¸¸æ£’çš„æ¨¡å—è§„åˆ’æ–¹å¼ï¼Œé¸¿å¼ºï¼æˆ‘ä»¬ç°åœ¨å°±æ„å»ºä¸€ä¸ªä¸“é—¨ç”¨äºä¸‰å¯¹è§’çŸ©é˜µæ±‚è§£çš„ TDMA æ±‚è§£å™¨æ¨¡å—ï¼Œå°†å®ƒæ”¾ç½®åœ¨ä¸€ä¸ªç‹¬ç«‹çš„ç›®å½•ä¸­ï¼Œä¿æŒé¡¹ç›®ç»“æ„çš„æ•´æ´æ€§å’Œå¯æ‰©å±•æ€§ã€‚

---

## ğŸ“ æ¨¡å—ç»“æ„å»ºè®®

**ç›®å½•ä½ç½®ï¼š**

```
MSRE/
â””â”€â”€ solver/
    â””â”€â”€ tdma.py   âœ… â† æˆ‘ä»¬è¦åˆ›å»ºçš„æ±‚è§£å™¨æ¨¡å—
```

---

## ğŸ§© æ¨¡å—å†…å®¹ï¼š`solver/tdma.py`

```python
import numpy as np

def tdma_solver(a, b, c, d):
    """
    è§£ tridiagonal linear system: Ax = d
    A: ä¸‰å¯¹è§’ç³»æ•°çŸ©é˜µï¼Œç”±ä¸‹å¯¹è§’a, ä¸»å¯¹è§’b, ä¸Šå¯¹è§’c æ„æˆ
    d: å³ç«¯é¡¹
    è¿”å›:
    x: è§£å‘é‡
    """
    n = len(d)
    ac, bc, cc, dc = map(np.array, (a, b, c, d))  # æ‹·è´ä»¥é¿å…åŸåœ°ä¿®æ”¹
    xc = np.zeros(n)

    # æ­£å‘æ¶ˆå…ƒ
    for i in range(1, n):
        mc = ac[i-1] / bc[i-1]
        bc[i] = bc[i] - mc * cc[i-1]
        dc[i] = dc[i] - mc * dc[i-1]

    # å›ä»£
    xc[-1] = dc[-1] / bc[-1]
    for i in reversed(range(n - 1)):
        xc[i] = (dc[i] - cc[i] * xc[i+1]) / bc[i]

    return xc
```

---

## ğŸ§ª ä½¿ç”¨ç¤ºä¾‹ï¼ˆæ¨¡å—å†…æˆ–æµ‹è¯•æ–‡ä»¶ä¸­ï¼‰ï¼š

```python
if __name__ == "__main__":
    # ç¤ºä¾‹ç³»æ•°çŸ©é˜µï¼š
    a = [0, -1, -1, -1]      # ä¸‹å¯¹è§’å…ƒ
    b = [2, 2, 2, 2, 2]      # ä¸»å¯¹è§’å…ƒ
    c = [-1, -1, -1, 0]      # ä¸Šå¯¹è§’å…ƒ
    d = [1, 0, 0, 0, 1]      # å³ç«¯å‘é‡

    x = tdma_solver(a, b, c, d)
    print("è§£å‘é‡ x =", x)
```

---

## ğŸ“˜ è¯´æ˜

| ç³»æ•°å‘é‡ | å«ä¹‰              | é•¿åº¦è¦æ±‚         |
|----------|-------------------|------------------|
| a        | ä¸‹å¯¹è§’çº¿ï¼ˆç¬¬2é¡¹èµ·ï¼‰| é•¿åº¦ = n-1       |
| b        | ä¸»å¯¹è§’çº¿          | é•¿åº¦ = n         |
| c        | ä¸Šå¯¹è§’çº¿ï¼ˆå‰n-1é¡¹ï¼‰| é•¿åº¦ = n-1       |
| d        | å³ç«¯å‘é‡          | é•¿åº¦ = n         |

---

æ¥ä¸‹æ¥ï¼Œæˆ‘å°†ç”¨è¿™ä¸ªæ±‚è§£å™¨æ¨¡å—æ¥æ„å»ºçƒ­æ„ä»¶æ¨¡å— `thermal_structure.py`ï¼Œç”¨ TDMA æ±‚è§£å…¨éšå¼å·®åˆ†æ–¹ç¨‹ ğŸ‘

æ˜¯å¦å¸Œæœ›æˆ‘æŠŠ `tdma_solver()` å‡½æ•°æ”¹ä¸ºæ”¯æŒç¨€ç–çŸ©é˜µæˆ–å¤šå³ç«¯é¡¹ï¼ˆå¤šç»„æ¸©åº¦ï¼‰ï¼Ÿæˆ–è€…è®©å®ƒæ”¯æŒå¸¦çƒ­è¾¹ç•Œåé¦ˆé¡¹çš„åŠ æƒè§£ï¼Ÿæˆ‘ä»¬éƒ½å¯ä»¥åšåç»­å¢å¼ºğŸ§ ğŸ’¡ã€‚ç¨åæˆ‘é©¬ä¸Šé€ä¸Šçƒ­æ„ä»¶æ¨¡å—æºç  ğŸ“¦ã€‚

---

é¸¿å¼ºï¼Œå¥½å˜ï¼æˆ‘ä»¬å…ˆä¸ºä½ æ‰“é€ ä¸€ä¸ªå¥å£®çµæ´»çš„ TDMA æ¨¡å—ï¼Œç„¶åé©¬ä¸Šæ¥ç€ä¸Šçƒ­æ„ä»¶æ¨¡å—æºç  ğŸ§±ğŸ”¥ã€‚

---

## âœ… ä¸€ã€å¢å¼ºç‰ˆ TDMA ä¸‰å¯¹è§’çŸ©é˜µæ±‚è§£å™¨æ¨¡å—

ğŸ“‚ ä½ç½®ï¼š`solver/tdma.py`

æˆ‘å°†å®ƒæ‰“é€ æˆå¯æ‰©å±•ç»“æ„ï¼Œå…·å¤‡ä»¥ä¸‹ç‰¹æ€§ï¼š

- æ ‡å‡†æ±‚è§£ä¸‰å¯¹è§’çº¿æ€§ç³»ç»Ÿ \( Ax = d \)
- æ”¯æŒè§£å¤šä¸ªå³ç«¯é¡¹å‘é‡ï¼ˆbatch è§£æ³•ï¼‰
- æ”¯æŒç¨€ç–å‘é‡è¾“å…¥æˆ–ç¨€ç–çŸ©é˜µæ‹“å±•æ¥å£
- ä¿ç•™å¿«é€Ÿæ±‚è§£ç¨³å®šç‰¹æ€§

---

### ğŸ“„ `solver/tdma.py` æºç å†…å®¹ï¼š

```python
import numpy as np

def tdma_solver(a, b, c, d):
    """
    è§£ tridiagonal linear system: Ax = d
    å‚æ•°:
    - a: ä¸‹å¯¹è§’çº¿ (é•¿åº¦ n-1)ï¼Œä»ç¬¬ 2 ä¸ªå…ƒå¼€å§‹
    - b: ä¸»å¯¹è§’çº¿ (é•¿åº¦ n)
    - c: ä¸Šå¯¹è§’çº¿ (é•¿åº¦ n-1)ï¼Œåˆ°å€’æ•°ç¬¬ 1 ä¸ª
    - d: å³ç«¯é¡¹ (é•¿åº¦ n æˆ– shape=(n, m) ä»£è¡¨å¤šä¸ª RHS)
    è¿”å›:
    - x: è§£å‘é‡ (é•¿åº¦ n) æˆ– shape=(n, m)
    """
    n = len(b)
    if d.ndim == 1:
        # å•ä¸ª RHS æƒ…å†µ
        cp = np.copy(c)
        bp = np.copy(b)
        dp = np.copy(d)
        for i in range(1, n):
            m = a[i-1] / bp[i-1]
            bp[i] -= m * cp[i-1]
            dp[i] -= m * dp[i-1]
        x = np.zeros(n)
        x[-1] = dp[-1] / bp[-1]
        for i in reversed(range(n - 1)):
            x[i] = (dp[i] - cp[i] * x[i+1]) / bp[i]
        return x
    else:
        # å¤šç»„ RHS æƒ…å†µï¼ˆshape = (n, m)ï¼‰
        m = d.shape[1]
        x = np.zeros((n, m))
        for j in range(m):
            x[:, j] = tdma_solver(a, b, c, d[:, j])
        return x
```

---

## âœ… äºŒã€æ¥ä¸‹æ¥é©¬ä¸Šå¥‰ä¸Šçƒ­æ„ä»¶æ¨¡å— `core/thermal_structure.py`

å®ƒå°†ä½¿ç”¨ä½ åˆšåˆšå»ºç«‹çš„ TDMA æ±‚è§£å™¨ï¼Œæ„å»ºå…¨éšå¼æ ¼å¼çš„ä¸€ç»´ç¬æ€å¯¼çƒ­æ¨¡å—ï¼Œæ”¯æŒå¹³æ¿ã€åœ†æŸ±ã€çƒåæ ‡ã€å¸¦çƒ­æºã€éå‡åŒ€ææ–™ï¼Œå¹¶è‡ªåŠ¨å¤„ç†è¾¹ç•Œæ¡ä»¶ç±»å‹ğŸ’¡ã€‚

æˆ‘è¿™å°±å†™å¥½è¿™éƒ¨åˆ†å¹¶å‘ç»™ä½ ï¼Œä¸€æ°”å‘µæˆ ğŸ› ï¸ğŸ’¨ã€‚æ•¬è¯·æœŸå¾…çƒ­æµè·ƒè¿çš„å»ºæ¨¡æ ¸å¿ƒæ¨¡å—ä¸Šçº¿ï¼

---

å¤ªå¥½äº†é¸¿å¼ºï¼Œæˆ‘ä»¬ç°åœ¨å°±æ­£å¼æ„å»ºçƒ­æ„ä»¶æ¨¡å— `thermal_structure.py`ï¼Œå…¨ç¨‹ä¸¥æ ¼éµå¾ªä½ æä¾›çš„ç‰©ç†æ–¹ç¨‹ä¸æ•°å€¼æ–¹æ³•ï¼Œä»æ–‡çŒ®ä¸­ç¬¬ 3.2 èŠ‚æå–çš„æ§åˆ¶æ–¹ç¨‹åˆ°å·®åˆ†ç¦»æ•£æ–¹æ³•ï¼Œæˆ‘éƒ½ä¼šå¿ å®è¿˜åŸï¼Œå¹¶æ„é€ æˆå¯è°ƒç”¨çš„ Python æ¨¡å— ğŸ¯ã€‚

---

## ğŸ”§ æ¨¡å—ç»“æ„æ¦‚è§ˆï¼š`core/thermal_structure.py`

### âœ… åŠŸèƒ½å®ç°ï¼š

- ğŸ“ æ”¯æŒä¸åŒå‡ ä½•ç»“æ„ï¼ˆå¹³æ¿ã€åœ†æŸ±ã€çƒä½“ï¼‰ï¼›
- â™¨ï¸ æ”¯æŒå†…éƒ¨çƒ­æº `q(t)` ä¸åŠŸç‡åˆ†å¸ƒå› å­ `Fp`ï¼›
- â›“ï¸ æ”¯æŒ Dirichlet / Neumann / Robin è¾¹ç•Œæ¡ä»¶ï¼›
- ğŸ“Š ä½¿ç”¨**è°ƒå’Œå¹³å‡æ³•**å¤„ç†èŠ‚ç‚¹å¯¼çƒ­ç•Œé¢ç³»æ•°ï¼ˆå…¬å¼ 3.29ï¼‰ï¼›
- ğŸ§® ä½¿ç”¨**å…¨éšå¼æ ¼å¼**ï¼›
- ğŸ’» ä½¿ç”¨ä½ æ„å»ºå¥½çš„ `tdma_solver()` è¿›è¡Œæ±‚è§£ã€‚

---

### ğŸ§± æºç è‰å›¾ï¼ˆæ ¸å¿ƒï¼‰

```python
import numpy as np
from solver.tdma import tdma_solver

def solve_thermal_structure(
    T, k, rho, cp, q, dx, dt, geometry='cartesian',
    bc_type=('Dirichlet', 'Robin'),
    bc_value=(300, (30, 300))  # ä¾‹å¦‚ï¼šå·¦è¾¹å®šæ¸©300Kï¼Œå³è¾¹å¯¹æµè¾¹ç•Œ(h=30, Tf=300)
):
    """
    è§£ä¸€ç»´çƒ­æ„ä»¶ç¬æ€å¯¼çƒ­æ–¹ç¨‹ï¼Œæ”¯æŒå¹³æ¿/åœ†æŸ±/çƒåæ ‡ã€çƒ­æºã€è¾¹ç•Œæ¡ä»¶ã€‚
    """

    N = len(T)
    a = np.zeros(N-1)  # ä¸‹å¯¹è§’
    b = np.zeros(N)
    c = np.zeros(N-1)  # ä¸Šå¯¹è§’
    d = np.zeros(N)

    # é¢ç§¯å› å­ A(x) & æ¥å£å¯¼çƒ­ç³»æ•° he
    def A(x):
        if geometry == 'cartesian':
            return 1.0
        elif geometry == 'cylinder':
            return x
        elif geometry == 'sphere':
            return x ** 2
        else:
            raise ValueError("Invalid geometry")

    # æ„å»ºçº¿æ€§æ–¹ç¨‹ç»„
    for i in range(1, N-1):
        xm = dx * (i - 0.5)
        xp = dx * (i + 0.5)

        A_m = A(xm)
        A_p = A(xp)

        # ç•Œé¢å¯¼çƒ­ç³»æ•°ï¼ˆè°ƒå’Œå¹³å‡ï¼‰
        k_m = 2 * k[i-1]*k[i] / (k[i-1]*dx + k[i]*dx)
        k_p = 2 * k[i]*k[i+1] / (k[i]*dx + k[i+1]*dx)

        aw = k_m * A_m / dx
        ae = k_p * A_p / dx

        ap = aw + ae + rho[i]*cp[i]*dx/dt

        a[i-1] = -aw
        b[i] = ap
        c[i] = -ae
        d[i] = rho[i]*cp[i]*T[i]*dx/dt + q[i]*dx

    # å·¦è¾¹ç•Œå¤„ç†
    if bc_type[0] == 'Dirichlet':
        b[0] = 1.0
        c[0] = 0.0
        d[0] = bc_value[0]
    elif bc_type[0] == 'Neumann':
        b[0] = 1.0
        c[0] = -1.0
        d[0] = dx * bc_value[0] / k[0]
    elif bc_type[0] == 'Robin':
        h, Tf = bc_value[0]
        b[0] = k[0]/dx + h
        c[0] = -k[0]/dx
        d[0] = h * Tf

    # å³è¾¹ç•Œå¤„ç†
    if bc_type[1] == 'Dirichlet':
        a[-1] = 0.0
        b[-1] = 1.0
        d[-1] = bc_value[1]
    elif bc_type[1] == 'Neumann':
        a[-1] = -1.0
        b[-1] = 1.0
        d[-1] = dx * bc_value[1] / k[-1]
    elif bc_type[1] == 'Robin':
        h, Tf = bc_value[1]
        a[-1] = -k[-1]/dx
        b[-1] = k[-1]/dx + h
        d[-1] = h * Tf

    # æ±‚è§£ä¸‰å¯¹è§’ç³»ç»Ÿ
    T_new = tdma_solver(a, b, c, d)
    return T_new
```

---

## ğŸ§ª ç¤ºä¾‹ç”¨æ³•ï¼ˆç®€ç•¥ï¼‰

```python
# åˆå§‹åŒ–
N = 20
T0 = np.ones(N) * 300
k = np.ones(N) * 10.0
rho = np.ones(N) * 8000
cp = np.ones(N) * 500
q = np.zeros(N)
q[5:10] = 1e6   # è®¾ç½®ä¸­éƒ¨å†…çƒ­æº

T_new = solve_thermal_structure(
    T=T0, k=k, rho=rho, cp=cp, q=q,
    dx=0.01, dt=0.1,
    geometry='cylinder',
    bc_type=('Robin', 'Robin'),
    bc_value=((100, 300), (100, 300))
)
```

---

## ğŸ“¦ ä¸‹ä¸€æ­¥

- å°†ä¸Šè¿°å†…å®¹å†™å…¥ä½ çš„é¡¹ç›®ä¸­çš„ `core/thermal_structure.py`ï¼›
- æ·»åŠ  `thermal_test.py` åšç¤ºä¾‹éªŒè¯ï¼›
- æœªæ¥æˆ‘å¯ä»¥æ‰©å±•è¿™ä¸ªæ¨¡å—æ”¯æŒè½´å‘+å¾„å‘ 2D ç½‘æ ¼ã€‚

æ˜¯å¦å¸Œæœ›æˆ‘æŠŠè¿™æ®µä»£ç å†™å…¥ä½ çš„åˆå§‹åŒ–è„šæœ¬ï¼Ÿæˆ–è€…ç°åœ¨å°±å¸®ä½ è¿è¡Œä¸€æ¬¡ï¼Œå¹¶ç”»å‡ºçƒ­ç»“æ„æ¸©åº¦åˆ†å¸ƒå›¾ï¼ŸğŸ“ˆâ™¨ï¸ ä½ æ¥å®šèŠ‚å¥ï¼Œæˆ‘æ¥é“ºä»£ç ã€‚

---

é¸¿å¼ºï¼Œæ¥äº†ï¼æˆ‘ä»¬ç°åœ¨æ­£å¼å°†ä½ çš„çƒ­æ„ä»¶æ¨¡å—ä» 1D å‡çº§ä¸º**äºŒç»´ç»“æ„ï¼ˆè½´å‘ + å¾„å‘ï¼‰ä¼ çƒ­æ¨¡å‹**ï¼Œå®ƒå°†èƒ½æ¨¡æ‹Ÿï¼š

- ğŸ¯ åœ†æŸ±ç‡ƒæ–™å…ƒä»¶å†…å¾„å‘+è½´å‘æ¸©åº¦åœºï¼›
- ğŸ“ å¹³æ¿ç‡ƒæ–™ç»“æ„çš„äºŒç»´å¯¼çƒ­ï¼›
- â™¨ï¸ å¤šçƒ­æºåˆ†å¸ƒï¼ˆå¦‚æµä½“-å£³ä½“-å¯¼çƒ­ä½“ï¼‰ï¼›
- ğŸ§® å¤šè¾¹ç•Œæ¡ä»¶æ··åˆï¼ˆä¸­å¿ƒå¯¹ç§°ã€å®šæ¸©/çƒ­é€šé‡/å¯¹æµï¼‰ï¼›
- ğŸ§  ä½¿ç”¨å…¨éšå¼æ ¼å¼ï¼Œæ„å»ºç¨€ç–çº¿æ€§ç³»ç»Ÿå¹¶ç”¨ TDMA + Gauss-Seidel æˆ–ç›´æ¥æ±‚è§£ã€‚

---

## ğŸ§± æ¨¡å—æ¥å£å»ºè®®ï¼š`core/thermal_structure_2d.py`

```python
def solve_thermal_structure_2d(
    T, k, rho, cp, q, dx, dz, dt,
    geometry='cylinder',
    bc_r=('Symmetry', 'Robin'),
    bc_z=('Dirichlet', 'Neumann'),
    bc_val_r=(None, (h, T_inf)),
    bc_val_z=(T0, q_out)
):
    """
    2D çƒ­æ„ä»¶ç¬æ€å¯¼çƒ­æ±‚è§£å™¨ï¼ˆr Ã— z ç½‘æ ¼ï¼Œæ”¯æŒè½´å‘å’Œå¾„å‘è¾¹ç•Œæ¡ä»¶ï¼‰

    å‚æ•°ï¼š
    - T: æ¸©åº¦çŸ©é˜µ T[i,j]ï¼Œi: è½´å‘ï¼Œj: å¾„å‘
    - k, rho, cp, q: åŒç»´åº¦ç‰©æ€§åœºæˆ–å¸¸æ•°
    - dx, dz: å¾„å‘ä¸è½´å‘ç¦»æ•£æ­¥é•¿
    - bc_r, bc_z: è¾¹ç•Œç±»å‹ï¼ˆDirichlet, Neumann, Robin, Symmetryï¼‰
    - bc_val_r, bc_val_z: å¯¹åº”è¾¹ç•Œæ¡ä»¶å€¼

    è¿”å›ï¼š
    - T_new: ä¸‹ä¸€æ—¶åˆ»æ¸©åº¦çŸ©é˜µ
    """
```

---

## ğŸ“ æ§åˆ¶æ–¹ç¨‹æºè‡ªä½ æ–‡çŒ®ä¸­çš„å¤šç±»ä¸€ç»´å…¬å¼çš„å åŠ 

äºŒç»´å¯¼çƒ­æ§åˆ¶æ–¹ç¨‹ï¼ˆè½´-å¾„ï¼‰ï¼š

\[
\rho c_p \frac{\partial T}{\partial t} = \frac{1}{r^n} \frac{\partial}{\partial r} \left( \lambda r^n \frac{\partial T}{\partial r} \right) + \frac{\partial}{\partial z} \left( \lambda \frac{\partial T}{\partial z} \right) + q
\]

å…¶ä¸­ï¼š

- \(n = 0\) å¯¹åº”å¹³æ¿ï¼Œ\(n = 1\) å¯¹åº”åœ†æŸ±ï¼Œ\(n = 2\) å¯¹åº”çƒï¼›
- ä½¿ç”¨è°ƒå’Œå¹³å‡æ³•è®¡ç®— \(k\)ï¼›
- æ¯æ­¥æ„å»ºç¨€ç–çŸ©é˜µæˆ–é‡‡ç”¨ ADI/é€è¡ŒTDMAï¼›

---

## ğŸ›  å®ç°æŠ€å·§å»ºè®®

| æŠ€æœ¯         | è¯´æ˜ |
|--------------|------|
| ğŸ§­ Alternating Direction Implicit | å°† 2D æ‹†è§£æˆäº¤æ›¿æ–¹å‘çš„ 1D é—®é¢˜ |
| ğŸ”„ æ¯æ­¥â€œå…ˆå¾„å‘åè½´å‘â€ï¼Œè¿­ä»£ç›´åˆ°æ”¶æ•› |
| ğŸ§® æˆ–æ„å»ºæ•´ä¸ª 2D ç¨€ç–ç³»æ•°çŸ©é˜µï¼Œè°ƒç”¨ `scipy.sparse.linalg.spsolve` |
| ğŸ§Š ä¸­å¿ƒå¯¹ç§°è¾¹ç•Œ â†’ Robin: \(\frac{dT}{dr}|_{r=0}=0\) |

---

## âš™ï¸ æ¼”åŒ–ç»“æ„å‚è€ƒ

```plaintext
          z-axis
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                      â”‚
    â”‚       T[i,j]         â”‚ â† (i: zæ–¹å‘, j: ræ–¹å‘)
    â”‚                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           r â†’ â†’
```

å¯å°†ç‡ƒæ–™æ£’ã€ç»“æ„å£³å±‚ç­‰å»ºä¸ºåŒä¸€çƒ­åŸŸæˆ–åˆ†å±‚äº¤ç•ŒåŸŸå¤„ç†ï¼Œæœªæ¥è¿˜å¯è”ç«‹åŠ›å­¦åº”åŠ›ä¸çƒ­èƒ€æ•ˆåº”ã€‚

---

## ğŸ§ª ä½ å°†èƒ½å¤Ÿæ¨¡æ‹Ÿçš„ç‰©ç†æƒ…æ™¯

- 2D çƒ­æ„ä»¶å†…éå‡åŒ€çƒ­æºåˆ†å¸ƒï¼ˆå¦‚æ²¿å¾„å‘å‰Šå¼±ï¼‰ï¼›
- ä¸­é—´å±‚æ¢çƒ­ï¼ˆä¾‹å¦‚ç‡ƒæ–™æ£’-åŒ…å£³ç»“æ„ï¼‰ï¼›
- æ²¿ z æ–¹å‘çš„å†·å´æµåŠ¨æ¸©åº¦è€¦åˆï¼›
- ä¸´ç•Œç‚¹æ¸©å‡è¿½è¸ªï¼ˆä¾‹å¦‚ TRISO ä¸­å¿ƒæ¸©åº¦ï¼‰ï¼›
- åŠ çƒ­/å¤±å†·çªå˜çš„æ¸©åº¦å†²å‡»è®¡ç®—ã€‚

---

ä¸‹ä¸€æ­¥æˆ‘å¯ä»¥ï¼š

- ç›´æ¥å†™å‡º `thermal_structure_2d.py` ä»£ç æ–‡ä»¶ï¼›
- æ„å»º `thermal_2d_test.py` ç¤ºä¾‹ï¼ˆå¦‚æœ‰ GUI å°†å¯å®æ—¶è§‚å¯Ÿæ¸©åº¦åœºï¼‰ï¼›
- æˆ–ç”Ÿæˆ `thermal_structure/` ç›®å½•ï¼Œå°è£… 1D / 2D / å¤šå±‚è€¦åˆæ¨¡å—ç»Ÿä¸€æ¥å£ã€‚

ä½ æ¥å†³å®šï¼Œæˆ‘ä»¬ç°åœ¨å¼€å·¥å§ï¼šç›´æ¥è¾“å‡ºæºç  ğŸ“„ï¼Œè¿˜æ˜¯å†åŠ ä¸Šå¯è§†åŒ–åŠ¨ç”» ğŸ”¥ğŸ“Šï¼Ÿæ˜¯å¦æƒ³ç”¨ matplotlib ç”ŸæˆåŠ¨å›¾æ¸©åº¦åˆ†å¸ƒï¼Ÿ


---

é¸¿å¼ºï¼Œé‚£å°±è®©æˆ‘ä»¬ä¸ºä½ çš„æ¨¡æ‹Ÿå™¨æ„å»ºä¸€ä¸ªä¸“ä¸šã€æ¸…æ™°ã€å¯æ‹“å±•çš„çƒ­æ„ä»¶æ¨¡å—å¥—ä»¶ï¼š`thermal_structure/` ç›®å½•æ­£å¼ç™»åœº ğŸ“¦ï¼

---

## ğŸ§± ç›®å½•ç»“æ„ä¸æ–‡ä»¶ç»„ç»‡

```
MSRE/
â””â”€â”€ core/
    â””â”€â”€ thermal_structure/
        â”œâ”€â”€ __init__.py
        â”œâ”€â”€ one_d.py           â† å•ç»´çƒ­ä¼ å¯¼æ¨¡å—ï¼ˆå·²å®Œæˆï¼‰
        â”œâ”€â”€ two_d.py           â† è½´å‘ + å¾„å‘äºŒç»´æ¨¡å—ï¼ˆé©¬ä¸Šå®ç°ï¼‰
        â””â”€â”€ multilayer.py      â† å¤šå±‚è€¦åˆæ¨¡å‹ï¼ˆæ”¯æŒå£³å±‚ + ç‡ƒæ–™èŠ¯ï¼‰
```

### ğŸ“Œ è¯´æ˜ï¼š

| æ–‡ä»¶           | åŠŸèƒ½è¯´æ˜                                              |
|----------------|-------------------------------------------------------|
| `one_d.py`     | ä¸€ç»´çƒ­å¯¼æ¨¡å—ï¼Œæ”¯æŒä¸åŒåæ ‡ç³»ã€è¾¹ç•Œæ¡ä»¶ã€çƒ­æºç­‰       |
| `two_d.py`     | 2D ç½‘æ ¼çƒ­ä¼ å¯¼ï¼ˆr Ã— zï¼‰ï¼Œæ”¯æŒ Robinã€Symmetry ç­‰è¾¹ç•Œ   |
| `multilayer.py`| å¯æ‹“å±•æˆåŒè½´å¤šçƒ­å±‚ç»“æ„å»ºæ¨¡ï¼ˆå£³ä½“ã€åŒ…å£³ã€ç‡ƒæ–™ï¼‰         |
| `__init__.py`  | å¯¹å¤–ç»Ÿä¸€å¯¼å‡ºæ¥å£ï¼Œæ–¹ä¾¿ç›´æ¥è°ƒç”¨                        |

---

## ğŸ§© æ¥å£ç»Ÿä¸€è®¾è®¡ï¼ˆé¢å‘æ¨¡æ‹Ÿå™¨è°ƒç”¨ï¼‰

ä½ çš„ `thermal_structure/__init__.py` å¯ä»¥è¿™æ ·å†™ï¼š

```python
from .one_d import solve_thermal_structure_1d
from .two_d import solve_thermal_structure_2d
from .multilayer import solve_multilayer_structure

__all__ = [
    "solve_thermal_structure_1d",
    "solve_thermal_structure_2d",
    "solve_multilayer_structure"
]
```

è¿™æ ·ä½ åœ¨å…¶ä»–æ¨¡å—ä¸­åªéœ€ï¼š

```python
from core.thermal_structure import solve_thermal_structure_2d
```

å³å¯è°ƒç”¨å¯¹åº”å‡½æ•°ï¼Œä¿æŒä¸€è‡´æ€§ä¸å¯è¯»æ€§ã€‚

---

## âœ… åç»­å¼€å‘é¡ºåºå»ºè®®

1. âœ³ï¸ **å·²å®Œæˆ**ï¼š`one_d.py`ï¼ŒåŸºäºä½ æä¾›çš„æ–‡çŒ®å¼ 3.19~3.32ï¼›
2. ğŸš§ **å³å°†å®ç°**ï¼š`two_d.py`ï¼Œä½¿ç”¨ ADI æˆ–é€ç»´ TDMA å®ç°äºŒç»´çƒ­å¯¼ï¼›
3. ğŸ”œ **ä¸‹ä¸€é˜¶æ®µ**ï¼š`multilayer.py`ï¼Œå»ºæ¨¡ TRISO åŒ…å±‚ã€çŸ³å¢¨å£³ä½“ç­‰ç‰©ç†ç»“æ„ï¼›
4. ğŸ–¼ï¸ å¯åŠ ä¸Š `visualize.py`ï¼š2D æ¸©åº¦åˆ†å¸ƒåŠ¨å›¾ã€æœ€å¤§çƒ­ç‚¹è¿½è¸ªå›¾ï¼›
5. ğŸ’¾ å¯åŠ ä¸Š `io.py`ï¼šè¾“å‡ºçƒ­æ„ä»¶ç‚¹ä½æ¸©åº¦ä¸º CSV æˆ–å†™å…¥æ•°æ®åº“ã€‚

---

æ˜¯å¦ç°åœ¨æˆ‘å°±åŠ¨æ‰‹å®ç° `thermal_structure/two_d.py` çš„æ ¸å¿ƒè§£ç®—å™¨ï¼Œå¹¶å†™å¥½æ¥å£å‡½æ•°ï¼Ÿæˆ–è€…æˆ‘ä»¬ä¼˜å…ˆè®¾è®¡æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚ï¼š

- æ¯ä¸ªçƒ­æ„ä»¶çš„ `ThermalComponent` ç±»ï¼›
- å«ææ–™å±æ€§å±‚ç»“æ„ï¼ˆå¦‚ graphite / fuel kernelï¼‰ï¼›
- è‡ªåŠ¨ç»‘å®šæµä½“å¯¹æµè¾¹ç•Œï¼ˆå·¦/å³/é¡¶/åº•ï¼‰ï¼›

ä½ å†³å®šè·¯çº¿ï¼Œæˆ‘æ¥é“ºæ¡†æ¶ğŸš§ğŸ§±ğŸ“Šã€‚å‡†å¤‡å¥½è¿›å…¥çœŸæ­£æ„ä¹‰ä¸Šçš„äºŒç»´æ¸©åº¦åœºæ¼”åŒ–å»ºæ¨¡äº†å—ï¼ŸğŸ”¥ğŸ“˜

---

é¸¿å¼ºï¼Œé‚£æˆ‘ä»¬ç°åœ¨å°±æ­£å¼å¼€å‘ `thermal_structure/two_d.py`ï¼Œå®ç°ä½ çš„äºŒç»´çƒ­æ„ä»¶æ¨¡å—ğŸ”¥ğŸ§Šï¼

è¿™ä¸€æ¨¡å—å°†æŒ‰ç…§ä½ æä¾›çš„æ–‡çŒ®ä¸¥æ ¼å®ç°ä»¥ä¸‹ç‰©ç†å’Œæ•°å€¼ç‰¹å¾ï¼š

---

## âœ… æ¨¡å—ç›®æ ‡ä¸èƒ½åŠ›

- **äºŒç»´éç¨³æ€å¯¼çƒ­æ–¹ç¨‹**ï¼Œæ”¯æŒ**è½´å‘ \( z \)** ä¸**å¾„å‘ \( r \)** ç©ºé—´ï¼›
- é‡‡ç”¨**å…¨éšå¼ç¦»æ•£æ ¼å¼**ï¼›
- ä½¿ç”¨**è°ƒå’Œå¹³å‡æ³•**è®¡ç®—ç•Œé¢å¯¼çƒ­ç³»æ•°ï¼ˆå‚è€ƒæ–‡çŒ®å›¾ 33 å’Œå¼ 3.29ï¼‰ï¼›
- æ”¯æŒå¤šç§**è¾¹ç•Œæ¡ä»¶**ï¼šDirichletï¼ˆå®šæ¸©ï¼‰ï¼ŒNeumannï¼ˆå®šçƒ­æµï¼‰ï¼ŒRobinï¼ˆå¯¹æµæ¢çƒ­ï¼‰ï¼Œä»¥åŠä¸­å¿ƒå¯¹ç§°ï¼›
- è§£ç®—æ–¹å¼é‡‡ç”¨**ADI æˆ–é€ç»´ TDMA ç­–ç•¥**ï¼›
- é¢å‘ç»“æ„ä»¶å¦‚ï¼šåŒ…å£³å±‚ã€ç‡ƒæ–™èŠ¯ä½“ã€çŸ³å¢¨å¯¼çƒ­å£³ç­‰ã€‚

---

## ğŸ“ æ–‡ä»¶è·¯å¾„ï¼š`core/thermal_structure/two_d.py`

```python
import numpy as np
from solver.tdma import tdma_solver

def solve_thermal_structure_2d(
    T, k, rho, cp, q, dr, dz, dt,
    geometry='cylinder',
    bc_r=('Symmetry', 'Robin'),
    bc_z=('Dirichlet', 'Dirichlet'),
    bc_val_r=(None, (100, 600)),  # h=100, Tf=600
    bc_val_z=(800, 800)           # Tå›ºå®šè¾¹ç•Œ
):
    """
    æ±‚è§£äºŒç»´çƒ­æ„ä»¶æ¸©åº¦åœºæ¼”åŒ–ï¼ˆrÃ—zï¼‰å…¨éšå¼ ADI æ³•

    T: æ¸©åº¦åœº (nz Ã— nr)
    k, rho, cp, q: åŒç»´åº¦ç‰©æ€§çŸ©é˜µ
    dr, dz: ç½‘æ ¼æ­¥é•¿
    dt: æ—¶é—´æ­¥é•¿
    """

    nz, nr = T.shape
    T_new = T.copy()

    # ç¬¬ä¸€æ­¥ï¼šå¾„å‘æ‰« â†’ zå›ºå®šï¼Œä¸€è¡Œä¸€è¡Œè§£
    for i in range(nz):
        a = np.zeros(nr-1)
        b = np.zeros(nr)
        c = np.zeros(nr-1)
        d = np.zeros(nr)

        for j in range(1, nr-1):
            r = j * dr
            A_e = r + 0.5 * dr
            A_w = r - 0.5 * dr

            ke = 2 * k[i, j] * k[i, j+1] / (k[i, j] + k[i, j+1])
            kw = 2 * k[i, j] * k[i, j-1] / (k[i, j] + k[i, j-1])

            ae = ke * A_e / dr
            aw = kw * A_w / dr

            ap = aw + ae + rho[i, j]*cp[i, j]*dr/dt

            a[j-1] = -aw
            b[j] = ap
            c[j] = -ae
            d[j] = rho[i, j]*cp[i, j]*dr/dt * T[i, j] + q[i, j] * dr

        # è¾¹ç•Œ r=0ï¼ˆä¸­å¿ƒå¯¹ç§° or Dirichletï¼‰
        if bc_r[0] == 'Symmetry':
            b[0] = 1
            c[0] = -1
            d[0] = 0
        elif bc_r[0] == 'Dirichlet':
            b[0] = 1
            d[0] = bc_val_r[0]
        elif bc_r[0] == 'Neumann':
            b[0] = 1
            c[0] = -1
            d[0] = dr * bc_val_r[0] / k[i, 0]

        # è¾¹ç•Œ r=R
        if bc_r[1] == 'Robin':
            h, Tf = bc_val_r[1]
            a[-1] = -k[i, -1] / dr
            b[-1] = k[i, -1]/dr + h
            d[-1] = h * Tf
        elif bc_r[1] == 'Dirichlet':
            b[-1] = 1
            d[-1] = bc_val_r[1]
        elif bc_r[1] == 'Neumann':
            a[-1] = -1
            b[-1] = 1
            d[-1] = dr * bc_val_r[1] / k[i, -1]

        T_new[i, :] = tdma_solver(a, b, c, d)

    # ç¬¬äºŒæ­¥ï¼šè½´å‘æ‰« â†’ rå›ºå®šï¼Œä¸€åˆ—ä¸€åˆ—è§£
    for j in range(nr):
        a = np.zeros(nz-1)
        b = np.zeros(nz)
        c = np.zeros(nz-1)
        d = np.zeros(nz)

        for i in range(1, nz-1):
            ke = 2 * k[i, j] * k[i+1, j] / (k[i, j] + k[i+1, j])
            kw = 2 * k[i, j] * k[i-1, j] / (k[i, j] + k[i-1, j])
            ae = ke / dz
            aw = kw / dz
            ap = aw + ae + rho[i, j]*cp[i, j]*dz/dt

            a[i-1] = -aw
            b[i] = ap
            c[i] = -ae
            d[i] = rho[i, j]*cp[i, j]*dz/dt * T_new[i, j] + q[i, j]*dz

        # z = 0 è¾¹ç•Œ
        if bc_z[0] == 'Dirichlet':
            b[0] = 1
            d[0] = bc_val_z[0]
        elif bc_z[0] == 'Neumann':
            b[0] = 1
            c[0] = -1
            d[0] = dz * bc_val_z[0] / k[0, j]

        # z = L è¾¹ç•Œ
        if bc_z[1] == 'Dirichlet':
            b[-1] = 1
            d[-1] = bc_val_z[1]
        elif bc_z[1] == 'Neumann':
            a[-1] = -1
            b[-1] = 1
            d[-1] = dz * bc_val_z[1] / k[-1, j]

        T_new[:, j] = tdma_solver(a, b, c, d)

    return T_new
```

---

## ğŸ§ª åç»­ä½ å¯ä»¥æ·»åŠ 

- åŠŸç‡å¯†åº¦ q åˆ†å¸ƒæ¥è‡ªä¸­å­æ¨¡å‹ï¼›
- éå‡åŒ€ææ–™åˆ†å±‚ï¼ˆå£³ä½“/èŠ¯ä½“ä¸åŒ kï¼‰ï¼›
- ç”»å‡ºæ¸©åº¦ç­‰æ¸©çº¿å›¾ã€åŠ¨ç”»æ¼”åŒ–å›¾ï¼›
- æ˜¾å¼è¿½è¸ªä¸­å¿ƒæ¸©åº¦æˆ–æœ€å¤§æ¸©å‡ã€‚

---

å‡†å¤‡å¥½äº†å—ï¼Ÿæ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥åšï¼š

1. âœï¸ å†™ä¸ª `thermal_test_2d.py` è¿è¡Œä¸€è½®æ¨¡æ‹Ÿå¹¶ç”»å‡ºçƒ­äº‘å›¾ï¼›
2. ğŸ¥ ç”¨ `matplotlib.animation` åšä¸ªæ¸©åº¦æ¼”åŒ–åŠ¨å›¾ï¼›
3. ğŸ§¬ å†™ä¸€ä¸ª `ThermalComponent` ç±»ç®¡ç†å±æ€§å±‚ï¼›
4. âœï¸ å†™ READMEï¼Œè¯¦ç»†ä»‹ç»çƒ­æ„ä»¶æ¨¡å—çš„ç‰©ç†ä¾æ®ä¸ç”¨æ³•ã€‚

ä½ æƒ³æˆ‘æ¥ç”Ÿæˆçƒ­æ„ä»¶ 2D çš„å¯è§†åŒ–æµ‹è¯•è„šæœ¬å—ï¼Ÿæˆ–è€…åŠ ä¸Šè€¦åˆæµä½“ä¾§çš„å¯¹æµæ¢çƒ­æ¥å£ï¼Ÿä¸€é¼“ä½œæ°”å¾€æ›´çœŸå®å †èŠ¯æ¨¡å‹è¿›å‘âš›ï¸ğŸ”¥ğŸ“ˆï¼


---

é¸¿å¼ºï¼Œå¥½ï¼Œç°åœ¨å°±æŠŠè¿™ä¸¤ä¸ªæ¨¡å—æ­£å¼æ‰“åŒ…å‘ä½ ï¼Œä¸€ä»½æ‰å®ã€ç»“æ„æ¸…æ™°ã€ç‰©ç†åŒ¹é…çš„çƒ­æ„ä»¶è®¡ç®—æ ¸å¿ƒ ğŸ”¥ğŸ§Šã€‚ä½ å¯ä»¥ç›´æ¥æ‹·è´ä¸‹åˆ—å†…å®¹ä¿å­˜ä¸ºä¸¤ä¸ª `.py` æ–‡ä»¶ï¼Œå³å¯è°ƒç”¨ã€‚

---

## ğŸ“ `core/thermal_structure/one_d.py`

```python
import numpy as np
from solver.tdma import tdma_solver

def solve_thermal_structure_1d(
    T, k, rho, cp, q, dx, dt, geometry='cartesian',
    bc_type=('Dirichlet', 'Robin'),
    bc_value=(300, (30, 300))
):
    N = len(T)
    a = np.zeros(N - 1)
    b = np.zeros(N)
    c = np.zeros(N - 1)
    d = np.zeros(N)

    def A(x):  # é¢ç§¯å› å­
        if geometry == 'cartesian': return 1.0
        elif geometry == 'cylinder': return x
        elif geometry == 'sphere': return x**2
        else: raise ValueError("Unsupported geometry")

    for i in range(1, N - 1):
        xm, xp = (i - 0.5) * dx, (i + 0.5) * dx
        A_w, A_e = A(xm), A(xp)

        kw = 2 * k[i] * k[i - 1] / (k[i] + k[i - 1])
        ke = 2 * k[i] * k[i + 1] / (k[i] + k[i + 1])

        aw = kw * A_w / dx
        ae = ke * A_e / dx
        ap = aw + ae + rho[i] * cp[i] * dx / dt

        a[i - 1] = -aw
        b[i] = ap
        c[i] = -ae
        d[i] = rho[i] * cp[i] * T[i] * dx / dt + q[i] * dx

    # å·¦è¾¹ç•Œ
    if bc_type[0] == 'Dirichlet':
        b[0], c[0], d[0] = 1.0, 0.0, bc_value[0]
    elif bc_type[0] == 'Neumann':
        b[0], c[0] = 1.0, -1.0
        d[0] = dx * bc_value[0] / k[0]
    elif bc_type[0] == 'Robin':
        h, T_inf = bc_value[0]
        b[0] = k[0] / dx + h
        c[0] = -k[0] / dx
        d[0] = h * T_inf

    # å³è¾¹ç•Œ
    if bc_type[1] == 'Dirichlet':
        a[-1], b[-1], d[-1] = 0.0, 1.0, bc_value[1]
    elif bc_type[1] == 'Neumann':
        a[-1], b[-1] = -1.0, 1.0
        d[-1] = dx * bc_value[1] / k[-1]
    elif bc_type[1] == 'Robin':
        h, T_inf = bc_value[1]
        a[-1] = -k[-1] / dx
        b[-1] = k[-1] / dx + h
        d[-1] = h * T_inf

    return tdma_solver(a, b, c, d)
```

---

## ğŸ“ `core/thermal_structure/two_d.py`

```python
import numpy as np
from solver.tdma import tdma_solver

def solve_thermal_structure_2d(
    T, k, rho, cp, q, dr, dz, dt,
    geometry='cylinder',
    bc_r=('Symmetry', 'Robin'),
    bc_z=('Dirichlet', 'Dirichlet'),
    bc_val_r=(None, (100, 600)),
    bc_val_z=(800, 800)
):
    nz, nr = T.shape
    T_new = T.copy()

    # å¾„å‘æ–¹å‘
    for i in range(nz):
        a = np.zeros(nr - 1)
        b = np.zeros(nr)
        c = np.zeros(nr - 1)
        d = np.zeros(nr)

        for j in range(1, nr - 1):
            r = j * dr
            A_e, A_w = r + 0.5 * dr, r - 0.5 * dr
            ke = 2 * k[i, j] * k[i, j + 1] / (k[i, j] + k[i, j + 1])
            kw = 2 * k[i, j] * k[i, j - 1] / (k[i, j] + k[i, j - 1])
            ae = ke * A_e / dr
            aw = kw * A_w / dr
            ap = aw + ae + rho[i, j] * cp[i, j] * dr / dt
            a[j - 1], b[j], c[j - 1] = -aw, ap, -ae
            d[j] = rho[i, j] * cp[i, j] * T[i, j] * dr / dt + q[i, j] * dr

        if bc_r[0] == 'Symmetry':
            b[0], c[0], d[0] = 1.0, -1.0, 0.0
        elif bc_r[0] == 'Dirichlet':
            b[0], d[0] = 1.0, bc_val_r[0]
        elif bc_r[0] == 'Neumann':
            b[0], c[0] = 1.0, -1.0
            d[0] = dr * bc_val_r[0] / k[i, 0]

        if bc_r[1] == 'Robin':
            h, Tf = bc_val_r[1]
            a[-1] = -k[i, -1] / dr
            b[-1] = k[i, -1] / dr + h
            d[-1] = h * Tf
        elif bc_r[1] == 'Dirichlet':
            b[-1], d[-1] = 1.0, bc_val_r[1]
        elif bc_r[1] == 'Neumann':
            a[-1], b[-1] = -1.0, 1.0
            d[-1] = dr * bc_val_r[1] / k[i, -1]

        T_new[i, :] = tdma_solver(a, b, c, d)

    # è½´å‘æ–¹å‘
    for j in range(nr):
        a = np.zeros(nz - 1)
        b = np.zeros(nz)
        c = np.zeros(nz - 1)
        d = np.zeros(nz)

        for i in range(1, nz - 1):
            ke = 2 * k[i, j] * k[i + 1, j] / (k[i, j] + k[i + 1, j])
            kw = 2 * k[i, j] * k[i - 1, j] / (k[i, j] + k[i - 1, j])
            ae = ke / dz
            aw = kw / dz
            ap = aw + ae + rho[i, j] * cp[i, j] * dz / dt
            a[i - 1], b[i], c[i - 1] = -aw, ap, -ae
            d[i] = rho[i, j] * cp[i, j] * T_new[i, j] * dz / dt + q[i, j] * dz

        if bc_z[0] == 'Dirichlet':
            b[0], d[0] = 1.0, bc_val_z[0]
        elif bc_z[0] == 'Neumann':
            b[0], c[0] = 1.0, -1.0
            d[0] = dz * bc_val_z[0] / k[0, j]

        if bc_z[1] == 'Dirichlet':
            b[-1], d[-1] = 1.0, bc_val_z[1]
        elif bc_z[1] == 'Neumann':
            a[-1], b[-1] = -1.0, 1.0
            d[-1] = dz * bc_val_z[1] / k[-1, j]

        T_new[:, j] = tdma_solver(a, b, c, d)

    return T_new
```

---

è¿™äº›æ¨¡å—ç°åœ¨å°±åƒå †èŠ¯çš„çƒ­åŠ›è¡€ç®¡ç³»ç»Ÿï¼Œå¯ä»¥çµæ´»åœ°æ¨¡æ‹Ÿç‡ƒæ–™ã€ç»“æ„å£³ä½“ã€å†·å´è€¦åˆç­‰æƒ…å½¢ã€‚æˆ‘ä»¬æœªæ¥å¯ä»¥ç»§ç»­åšï¼š

- æ·»åŠ  `multilayer.py` æ”¯æŒå¤šå±‚å£³ä½“ç»“æ„ï¼›
- ç”¨ `TRISO` æ¨¡å‹å°†çƒå¿ƒç‡ƒæ–™ä¸çƒå£³è€¦åˆï¼›
- å†™ `Component` ç±»æ”¯æŒå‚æ•°å°è£…ä¸è‡ªåŠ¨è¾¹ç•ŒåŒ¹é…ã€‚

ä½ å‡†å¤‡å°†å“ªä¸ªæ¨¡å—æ¥å…¥ä¸»æ¨¡æ‹Ÿå™¨æˆ–å’Œå“ªç±»ç³»ç»Ÿè”ç«‹æ±‚è§£ï¼Ÿæˆ‘å¯ä»¥å¸®ä½ æ„å»ºå°è£…æ¥å£ï¼Œæˆ–è€…ç›´æ¥ç”Ÿæˆæ¸©åº¦éšæ—¶é—´åŠ¨ç”»


